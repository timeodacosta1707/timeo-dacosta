<section class="projects-hero" [class.full-screen]="!selectedProject">
    <div class="title-section">
        @if (!selectedProject) {
        <h1>MES</h1>
        <h1>PROJETS</h1>
        } @else {
        <h1 class="project-title-detail">{{ selectedProject.title }}</h1>
        }
    </div>
</section>

@if (!selectedProject) {
<section class="projects-carousel-section" (window:mouseup)="onMouseUp()" (window:touchend)="onMouseUp()"
    (window:mousemove)="onMouseMove($event)" (window:touchmove)="onTouchMove($event)">

    <div class="carousel-container" (mousedown)="onMouseDown($event, 'top')" (touchstart)="onTouchStart($event, 'top')"
        (mouseenter)="onTrackHover('top', true)" (mouseleave)="onTrackHover('top', false)">
        <div class="carousel-track" #trackTop>
            @for (project of projectsTop; track $index) {
            <app-project-card [title]="project.title" [description]="project.description" [imageUrl]="project.imageUrl"
                (viewDetails)="navigateToProject(project)">
            </app-project-card>
            }
            @for (project of projectsTop; track $index) {
            <app-project-card [title]="project.title" [description]="project.description" [imageUrl]="project.imageUrl"
                (viewDetails)="navigateToProject(project)">
            </app-project-card>
            }
        </div>
    </div>

    <div class="drag-separator">
        <div class="line"></div>
        <span class="hint-text">DRAG & DROP TO EXPLORE</span>
        <div class="line"></div>
    </div>

    <div class="carousel-container" (mousedown)="onMouseDown($event, 'bottom')"
        (touchstart)="onTouchStart($event, 'bottom')" (mouseenter)="onTrackHover('bottom', true)"
        (mouseleave)="onTrackHover('bottom', false)">
        <div class="carousel-track" #trackBottom>
            @for (project of projectsBottom; track $index) {
            <app-project-card [title]="project.title" [description]="project.description" [imageUrl]="project.imageUrl"
                (viewDetails)="navigateToProject(project)">
            </app-project-card>
            }
            @for (project of projectsBottom; track $index) {
            <app-project-card [title]="project.title" [description]="project.description" [imageUrl]="project.imageUrl"
                (viewDetails)="navigateToProject(project)">
            </app-project-card>
            }
        </div>
    </div>
</section>
}

@if (selectedProject && activeGalleryMedia) {
<section class="project-detail-view">
    <button class="btn-back" (click)="closeProjectDetail()">← Retour aux projets</button>
    <div class="detail-container">
        <div class="detail-gallery">
            <div class="main-image-wrapper" [class.is-maquette]="activeGalleryMedia.isMaquette"
                [class.is-video]="activeGalleryMedia.type === 'video'" #maquetteContainer
                (mousemove)="onMaquetteMouseMove($event, maquetteContainer)" (mouseleave)="onMaquetteMouseLeave()">

                @if (activeGalleryMedia.type === 'video') {

                @if (activeGalleryMedia.isGif) {
                <video [src]="activeGalleryMedia.url" autoplay loop muted playsinline class="main-video">
                </video>
                } @else {
                <iframe [src]="activeGalleryMedia.url" title="Video player" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen class="main-video">
                </iframe>
                }

                } @else {
                <img [src]="activeGalleryMedia.url" alt="Image principale" class="main-img" #imgRef
                    [style.transform]="activeGalleryMedia.isMaquette ? maquetteTransform : 'none'">
                }
            </div>

            <div class="thumbnails-container">

                @if (projectMediaList.length > 6) {
                <button class="nav-arrow prev" (click)="scrollThumbnails('left')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                }

                <div class="thumbnails" #thumbnailList>
                    @for (mediaObj of projectMediaList; track mediaObj) {
                    <div class="thumb-wrapper" [class.active]="mediaObj === activeGalleryMedia"
                        (click)="setActiveMedia(mediaObj)">

                        <img [src]="mediaObj.type === 'video' ? mediaObj.thumbnailUrl : mediaObj.url" alt="Miniature">

                        @if (mediaObj.type === 'video') {
                        <div class="play-icon">▶</div>
                        }
                    </div>
                    }
                </div>

                @if (projectMediaList.length > 6) {
                <button class="nav-arrow next" (click)="scrollThumbnails('right')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18l6-6-6-6" />
                    </svg>
                </button>
                }
            </div>
        </div>

        <div class="detail-info">
            <div class="info-header">
                <h2>À propos</h2>
                <p class="description">{{ selectedProject.description }}</p>

                @if (selectedProject.challenge) {
                <div class="challenge-box">
                    <h4>Challenge</h4>
                    <p>{{ selectedProject.challenge }}</p>
                </div>
                }
            </div>

            <div class="specs-grid">
                @if (selectedProject.client) {
                <div class="spec-item"><label>Client</label><span>{{ selectedProject.client }}</span></div>
                }
                @if (selectedProject.year) {
                <div class="spec-item"><label>Année</label><span>{{ selectedProject.year }}</span></div>
                }
                @if (selectedProject.duration) {
                <div class="spec-item"><label>Durée</label><span>{{ selectedProject.duration }}</span></div>
                }
                @if (selectedProject.role) {
                <div class="spec-item"><label>Rôle</label><span>{{ selectedProject.role }}</span></div>
                }
            </div>

            <div class="technologies">
                <label>Technologies</label>
                <div class="tags">
                    @for (tech of selectedProject.technologies; track $index) {
                    <span class="tech-tag">{{ tech }}</span>
                    }
                </div>
            </div>

            <div class="actions">
                @if (selectedProject.buttons) {
                @for (btn of selectedProject.buttons; track $index) {
                <a [attr.href]="btn.disabled ? null : btn.link" [attr.target]="btn.disabled ? null : '_blank'"
                    class="btn-base" [class.btn-primary]="btn.type === 'primary'"
                    [class.btn-secondary]="btn.type === 'secondary'" [class.disabled]="btn.disabled"
                    [attr.aria-disabled]="btn.disabled">
                    {{ btn.label }}
                </a>
                }
                }
            </div>
        </div>
    </div>
</section>
}

@if (!selectedProject) {
<section class="cta-section">
    <div class="cta-content">
        <h2>UN PROJET EN TÊTE ?</h2>
        <p>Transformons vos idées en réalité digitale.</p>
        <a routerLink="/contact" class="cta-btn">
            <span>ME CONTACTER</span>
            <div class="hover-effect"></div>
        </a>
    </div>
</section>
}